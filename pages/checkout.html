<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tienda Urbana</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="navbar">
        <div class="container nav-content">

            <a href="../index.html" class="logo">Tienda Urbana</a>

            <nav class="nav-links">
                <a href="../index.html">Inicio</a>
                <a href="./pages/cart.html">
                    ðŸ›’ Carrito 
                    <span id="cart-count" class="cart-count">0</span>
                </a>
            </nav>

        </div>
    </header>

    <h1>Tienda Urbana</h1>

    <!-- BotÃ³n para pagar -->
    <button id="mp-pay-button">Pagar con Mercado Pago</button>

    <!-- SDK de Mercado Pago -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>

    <script>
        // 1. PonÃ© tu Public Key de Mercado Pago (modo prueba para empezar)
        const publicKey = "TU_PUBLIC_KEY_AQUI";

        // 2. InicializÃ¡ Mercado Pago con tu Public Key
        const mp = new MercadoPago(publicKey, {
            locale: 'es-AR'
        });

        // 3. LlamÃ¡ al backend para obtener el preferenceId
        async function obtenerPreferenceId() {
            const response = await fetch("/crear_preferencia", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                // PodÃ©s enviar los items del carrito como JSON
                body: JSON.stringify({ items: [{ title: "Remera Negra", quantity: 1, unit_price: 10000 }] })
            });

            const data = await response.json();
            return data.preferenceId;
        }

        // 4. ConfigurÃ¡ el botÃ³n de pago con la preferenceId
        document.getElementById("mp-pay-button").addEventListener("click", async () => {
            const preferenceId = await obtenerPreferenceId();

            mp.bricks().create("wallet", "mp-pay-button", {
                initialization: {
                    preferenceId: preferenceId
                },
                callbacks: {
                    onError: (error) => console.error(error)
                }
            });
        });
    </script>

</body>
</html>